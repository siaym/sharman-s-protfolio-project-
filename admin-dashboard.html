<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:Inter,system-ui;
  background:#0b0b0c;
  color:#fff;
  min-height:100vh;
}
header{
  padding:20px 30px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid rgba(255,255,255,.08);
}
header h1{font-size:20px}
header button{
  background:#ff4d4d;
  border:none;
  color:#fff;
  padding:8px 14px;
  border-radius:6px;
  cursor:pointer;
  font-weight:600;
}

main{max-width:1100px;margin:40px auto;padding:0 20px}

.tabs{
  display:flex;
  gap:12px;
  margin-bottom:20px;
}
.tabs button{
  padding:10px 16px;
  border-radius:8px;
  border:none;
  cursor:pointer;
  background:#1a1a1c;
  color:#fff;
  font-weight:600;
}
.tabs button.active{background:#14c304;color:#000}

.counter{
  margin:10px 0 20px;
  opacity:.8;
}

.form{
  background:#141415;
  padding:20px;
  border-radius:12px;
  margin-bottom:30px;
}
.form h3{margin-bottom:14px}
.form input{
  width:100%;
  padding:10px;
  margin-bottom:12px;
  border-radius:6px;
  border:none;
}
.form button{
  padding:10px 16px;
  border:none;
  border-radius:6px;
  background:#14c304;
  color:#000;
  font-weight:700;
  cursor:pointer;
}

.list{
  display:grid;
  gap:14px;
}
.item{
  display:grid;
  grid-template-columns:80px 1fr auto;
  gap:14px;
  align-items:center;
  background:#141415;
  padding:12px;
  border-radius:10px;
}
.item img{
  width:80px;
  height:60px;
  object-fit:cover;
  border-radius:6px;
  background:#000;
}
.item h4{font-size:14px}
.item small{opacity:.7;word-break:break-all}
.actions button{
  margin-left:6px;
  padding:6px 10px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:600;
}
.actions .edit{background:#ffc107;color:#000}
.actions .delete{background:#ff4d4d;color:#fff}
</style>
</head>

<body>

<header>
  <h1>Admin Dashboard</h1>
  <button onclick="logout()">Logout</button>
</header>

<main>

<div class="tabs">
  <button id="tab-mywork" class="active" onclick="switchTab('mywork')">
    Dribbble (My Work)
  </button>
  <button id="tab-case" onclick="switchTab('casestudy')">
    Behance (Case Study)
  </button>
</div>

<div class="counter" id="counter">Total: 0 items</div>

<div class="form">
  <h3 id="formTitle">Add New Item</h3>
  <input type="text" id="title" placeholder="Project title">
  <input type="text" id="link" placeholder="Dribbble / Behance link">
  <input type="file" id="image">
  <button onclick="saveItem()">Save</button>
</div>

<div class="list" id="list"></div>

</main>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
/* ðŸ”¥ FIREBASE INIT */
const firebaseConfig = {
  apiKey: "AIzaSyARRuy_LK77TV9_xk7qngO6F99Bf63TmjE",
  authDomain: "my-protfolio-36077.firebaseapp.com",
  projectId: "my-protfolio-36077",
  storageBucket: "my-protfolio-36077.appspot.com",
  messagingSenderId: "889602371178",
  appId: "1:889602371178:web:1afebab03b1f1e6bf5a413"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();
</script>

<script>
let currentTab = "mywork";
let editId = null;
let unsubscribe = null;

/* ðŸ” AUTH GUARD */
auth.onAuthStateChanged(user=>{
  if(!user){
    window.location.replace("admin.html");
  }
});

/* ðŸ”„ TAB SWITCH */
function switchTab(tab){
  currentTab = tab;
  editId = null;
  document.getElementById("formTitle").innerText = "Add New Item";
  document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
  document.getElementById(tab==="mywork" ? "tab-mywork" : "tab-case").classList.add("active");
  loadItems();
}

/* ðŸ“¥ LOAD ITEMS (SAFE) */
function loadItems(){
  if(unsubscribe) unsubscribe();

  unsubscribe = db.collection(currentTab)
    .orderBy("created","desc")
    .onSnapshot(snap=>{
      const list = document.getElementById("list");
      list.innerHTML = "";
      document.getElementById("counter").innerText = `Total: ${snap.size} items`;

      let index = 1;
      snap.forEach(doc=>{
        const d = doc.data();
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <img src="${d.img || ''}">
          <div>
            <h4>${index++}. ${d.title}</h4>
            <small>${d.link}</small>
          </div>
          <div class="actions">
            <button class="edit" onclick="editItem('${doc.id}','${d.title}','${d.link}')">Edit</button>
            <button class="delete" onclick="deleteItem('${doc.id}','${d.img || ''}')">Delete</button>
          </div>`;
        list.appendChild(div);
      });
    });
}

/* ðŸ’¾ SAVE ITEM */
function saveItem(){
  const title = document.getElementById("title").value.trim();
  const link = document.getElementById("link").value.trim();
  const file = document.getElementById("image").files[0];

  if(!title || !link) return alert("Fill all fields");

  if(editId && !file){
    db.collection(currentTab).doc(editId).update({ title, link });
    resetForm();
    return;
  }

  if(!file) return alert("Image required for new items");

  const ref = storage.ref(`${currentTab}/${Date.now()}_${file.name}`);
  ref.put(file).then(snap =>
    snap.ref.getDownloadURL().then(url=>{
      const data = {
        title,
        link,
        img: url,
        created: firebase.firestore.FieldValue.serverTimestamp()
      };
      editId
        ? db.collection(currentTab).doc(editId).update(data)
        : db.collection(currentTab).add(data);
      resetForm();
    })
  );
}

/* âœï¸ EDIT */
function editItem(id,title,link){
  editId = id;
  document.getElementById("formTitle").innerText = "Edit Item";
  document.getElementById("title").value = title;
  document.getElementById("link").value = link;
}

/* ðŸ—‘ DELETE */
function deleteItem(id,img){
  if(!confirm("Delete this item?")) return;

  db.collection(currentTab).doc(id).delete().then(()=>{
    if(img && img.startsWith("http")){
      storage.refFromURL(img).delete().catch(()=>{});
    }
  });
}

/* ðŸ”„ RESET */
function resetForm(){
  editId = null;
  document.getElementById("formTitle").innerText = "Add New Item";
  document.getElementById("title").value = "";
  document.getElementById("link").value = "";
  document.getElementById("image").value = "";
}

/* ðŸšª LOGOUT */
function logout(){
  auth.signOut().then(()=>{
    window.location.replace("admin.html");
  });
}

/* ðŸš€ INIT */
loadItems();
</script>

</body>
</html>
